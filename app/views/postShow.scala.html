@(post: Post, commentKey:Long, commentForm: Form[Comment], currentPage: Page[Comment], upVotedPostKeys:Set[Long], downVotedPostKeys:Set[Long])
@import helper._ 
@import helper.twitterBootstrap._
@import helper.H._
@import be.objectify.deadbolt.utils.TemplateUtils._
@import views.html.security._
@import helper.UserHelper._

@script() = {
	<script type="text/javascript" src='@routes.Assets.at("javascripts/report.js")'></script>
}

@template.main(post.getTitle(), script, partials.opengraphHead(post)) {
  <div class="container-fluid">
    <div class="row-fluid">
        <div class="span2">
		    <p>
        		@partials.image(post.getImage())
        	</p>
        	@if(post.getCategory() != null) {
		    <p>
        		<span class="label">@Messages("Category." + post.getCategory().getName())</span>
		    </p>
        	}
		    <p class="lead">
                <strong class="rating" data-key="rate-@post.getKey()" >@post.getRating()</strong>
                @partials.rateButtons(post, upVotedPostKeys, downVotedPostKeys)                    
		    </p>
		    <p class="lead">
                @partials.reportPostButton(post)                    
		    </p>
        </div>
        
        <div class="span6">
		    <div class="row">
		    	<p class="lead nl-withoutSpace">@post.getTitle()</p>
		    </div>
    		<div class="row">
       			<p class="nl-withoutSpace">@post.getContent()</p>
       			<small>
 			        @if(post.getUpdatedBy() == null) { 
			        @Html(Messages("CreatedOn_By", prettify(post.getCreatedOn()), partials.userProfile(post.getCreatedBy()))) } else { 
			        @Html(Messages("UpdatedOn_By", prettify(post.getUpdatedOn()), partials.userProfile(post.getUpdatedBy()))) }
       			</small>
		        @restrictCombine(la(as("admin")), "models.Post.delete." + post.getKey()) {
		        <a class="btn btn-mini btn-danger pull-right spaced" href="@routes.App.postDelete(post.getKey())">@Messages("delete")</a>
		        }
		        @restrictCombine(la(as("admin")), "models.Post.edit." + post.getKey()) {
		        <a class="btn btn-mini pull-right spaced" href="@routes.App.postEditForm(post.getKey())">@Messages("edit")</a>
		        }
    		</div>
	    </div>
    </div>

    <div class="row-fluid">
        <div class="span9">
        <hr/>
        <div class="fb-like" data-href="" data-send="false" data-width="550"  data-show-faces="true"></div>
        </div>
    </div>
    
    <div class="row-fluid">
        <div class="span9">
    @* comments *@
    @if(currentPage.getTotalRowCount == 0) {
        
        <div class="well">
            <h4>@Messages("no_comments_yet")</h4>
        </div>
        
    } else {

        <table class="comments table table-striped table-bordered">
            <thead>
                <tr>
                    <th class="header">@Messages("Comments")</th>
                </tr>
            </thead>
            <tbody>
        @for(comment <- currentPage.getList.reverse) {
                <tr id="@comment.getKey()">
                    <td>
                        <small>
                        @if(comment.getUpdatedBy() == null) { 
                        @Html(Messages("CreatedOn_By", prettify(comment.getCreatedOn()), partials.userProfile(comment.getCreatedBy()))) } else { 
                        @Html(Messages("UpdatedOn_By", prettify(comment.getUpdatedOn()), partials.userProfile(comment.getUpdatedBy()))) }
                        </small>
                        @restrictCombine(la(as("admin")), "models.Comment.edit." + comment.getKey()) {
                        <a class="btn btn-mini" href="@routes.App.commentEditForm(post.getKey(), comment.getKey())#form">@Messages("edit")</a>
                        }
                        @restrictCombine(la(as("admin")), "models.Comment.delete." + comment.getKey()) {
                        <a class="btn btn-mini btn-danger" href="@routes.App.commentDelete(post.getKey(), comment.getKey())">@Messages("delete")</a>
                        }
                    </td> 
                </tr>

                <tr><td><p class="nl-withoutSpace">@comment.getContent()</p></td></tr>
        }
            </tbody>
        </table>
        
        @partials.pagination(currentPage, Constants.COMMENTS_PER_PAGE, 
            routes.App.postShow(post.getKey(), sanitizeURL(post.getTitle()), currentPage.getPageIndex - 1),
            routes.App.postShow(post.getKey(), sanitizeURL(post.getTitle()), currentPage.getPageIndex + 1))
        
        <h4>@Messages("drop_your_comment")</h4>
    }
        </div>
    </div>
    
    <div class="row-fluid">
        <div class="span9">

        @form(if(commentKey != null) { routes.App.commentUpdate(post.getKey(), commentKey) } 
              else                   { routes.App.commentCreate(post.getKey(), sanitizeURL(post.getTitle())) } , 'id -> "form") { 
            
            @textarea(commentForm("content"), args = '_label -> Messages("Comment.content.label"),'rows -> 4,'class->"input-xxlarge", Symbol("data-maxchars") -> "2000", '_showConstraints -> false)
            
            <div>
			@roleHolderPresent() {
               <input type="submit" class="btn btn-success" value="@if(commentKey != null) { @Messages("Update") } else { @Messages("Post") }">
               @Html(Messages("as_profile", partials.userProfile(loginUser())))
			}
			@roleHolderNotPresent() {
               <input type="submit" class="btn btn-success" data-toggle="modal" data-target="#loginModal" value="@if(commentKey != null) { @Messages("Update") } else { @Messages("Post") }">
			}
        	</div>
       }
    	</div>
	</div>
	
</div>
    
}
